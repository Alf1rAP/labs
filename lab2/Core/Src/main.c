#include "stm32f4xx.h"

#define BUTTON_PIN   0

void delay(volatile uint32_t n) {
    while (n--);
}

int main(void)
{
    uint32_t i;

    // Включаем тактирование порта GPIOD для светодиодов
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIODEN;
    // Включаем тактирование порта GPIOA для кнопки
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN;

    // Настроим пины GPIOD на выход (для светодиодов)
    GPIOD->MODER |= 0x55000000;   // Пины 12-15 на выход
    GPIOD->OTYPER &= ~0x0000;     // Выходы с подтягивающими резисторами
    GPIOD->OSPEEDR &= ~0x00000000; // Нормальная скорость

    // Настроим пин для кнопки (вход)
    GPIOA->MODER &= ~0x00000003;  // Пин на вход (00)

    while (1)
    {
        // Проверяем состояние кнопки
        if (GPIOA->IDR & (1 << BUTTON_PIN))
        {
            // Включаем светодиоды по очереди
            for (i = 0; i < 4; i++) {
                GPIOD->ODR = (1 << (12 + i));  // Включаем светодиод
                delay(50000);  // Задержка
                GPIOD->ODR &= ~(1 << (12 + i)); // Выключаем светодиод
            }
            // Задержка после полного цикла
            delay(200000);  // Пауза между циклами
        }
        else {
            // Если кнопка не нажата, выключаем все светодиоды
            GPIOD->ODR = 0x0000;
        }
    }
}
